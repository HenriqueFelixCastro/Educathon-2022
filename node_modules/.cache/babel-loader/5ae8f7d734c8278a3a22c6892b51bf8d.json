{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n/**\n * Copyright IBM Corp. 2020, 2021\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport axios from 'axios';\nimport { LocaleAPI } from '../Locale';\nimport root from 'window-or-global';\n/**\n * @constant {string | string} Host for the Translation API call\n * @private\n */\n\nvar _host = process && (process.env.REACT_APP_TRANSLATION_HOST || process.env.TRANSLATION_HOST) || 'https://1.www.s81c.com';\n/**\n * Translation API default endpoint\n *\n * @type {string}\n * @private\n */\n\n\nvar _ddsEndpointDefault = '/common/carbon-for-ibm-dotcom/translations/masthead-footer';\n/**\n * Translation API endpoint\n *\n * @type {string}\n * @private\n */\n\nvar _ddsEndpoint = process && (process.env.REACT_APP_DDS_TRANSLATION_ENDPOINT || process.env.DDS_TRANSLATION_ENDPOINT) || _ddsEndpointDefault;\n/**\n * Session Storage key for translation data\n *\n * @type {string}\n * @private\n */\n\n\nvar _sessionTranslationKey = 'dds-translation';\n/**\n * The cache for in-flight or resolved requests for the i18n data, keyed by the initiating locale.\n *\n * @type {object}\n * @private\n */\n\nvar _requestsTranslation = {};\n/**\n * Sets the default location if nothing is returned\n *\n * @type {object}\n * @private\n */\n\nvar _localeDefault = {\n  lc: 'en',\n  cc: 'us'\n};\n/**\n * Two hours in milliseconds to compare session timestamp.\n *\n * @type {number}\n * @private\n */\n\nvar _twoHours = 60 * 60 * 2000;\n/**\n * Translation API class with methods for fetching i18n data for ibm.com\n */\n\n\nvar TranslationAPI = /*#__PURE__*/function () {\n  function TranslationAPI() {\n    _classCallCheck(this, TranslationAPI);\n  }\n\n  _createClass(TranslationAPI, null, [{\n    key: \"clearCache\",\n\n    /**\n     * Clears the cache.\n     *\n     * @param {string} endpoint specified API non-default endpoint (optional)\n     */\n    value: function clearCache(endpoint) {\n      var sessionKey = this.getSessionKey(endpoint);\n\n      if (typeof sessionStorage !== 'undefined') {\n        Object.keys(_requestsTranslation).forEach(function (key) {\n          return delete _requestsTranslation[key];\n        });\n\n        for (var i = 0; i < sessionStorage.length; ++i) {\n          var key = sessionStorage.key(i);\n\n          if (key.indexOf(sessionKey) === 0) {\n            sessionStorage.removeItem(key);\n          }\n        }\n      }\n    }\n    /**\n     * Returns translation i18n data\n     *\n     * @param {object} codes object containing lc and cc\n     * @param {string} endpoint endpoint to fetch data from (optional)\n     *\n     * @returns {Promise<any>} Translation data\n     * @example\n     * import { TranslationAPI } from '@carbon/ibmdotcom-services';\n     *\n     * async function getTranslation() {\n     *   const response = await TranslationAPI.getTranslation({\n     *     lc: 'en',\n     *     cc: 'us',\n     *   });\n     *   return response;\n     * }\n     */\n\n  }, {\n    key: \"getTranslation\",\n    value: function () {\n      var _getTranslation = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(codes, endpoint) {\n        var _this = this;\n\n        var lang, country, locale;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                lang = 'en';\n                country = 'us';\n\n                if (!(codes && codes.lc && codes.cc)) {\n                  _context.next = 7;\n                  break;\n                }\n\n                lang = codes.lc;\n                country = codes.cc;\n                _context.next = 12;\n                break;\n\n              case 7:\n                _context.next = 9;\n                return LocaleAPI.getLocale();\n\n              case 9:\n                locale = _context.sent;\n                lang = locale.lc;\n                country = locale.cc;\n\n              case 12:\n                return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this.fetchTranslation(lang, country, endpoint, resolve, reject);\n                }));\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getTranslation(_x, _x2) {\n        return _getTranslation.apply(this, arguments);\n      }\n\n      return getTranslation;\n    }()\n    /**\n     * Fetches the translation data from sessionStorage or data fetch\n     *\n     * @param {string} lang Language code\n     * @param {string} country Country code\n     * @param {string} endpoint endpoint to fetch data (optional)\n     * @param {Function} resolve resolves the Promise\n     * @param {Function} reject rejects the promise\n     * @private\n     */\n\n  }, {\n    key: \"fetchTranslation\",\n    value: function fetchTranslation(lang, country, endpoint, resolve, reject) {\n      var _this2 = this;\n\n      var sessionKey = this.getSessionKey(endpoint);\n      var itemKey = \"\".concat(sessionKey, \"-\").concat(country, \"-\").concat(lang);\n      var sessionTranslation = this.getSessionCache(itemKey);\n\n      if (sessionTranslation) {\n        resolve(sessionTranslation);\n      } else {\n        var key = country !== 'undefined' ? \"\".concat(country, \"-\").concat(lang) : \"\".concat(lang);\n\n        if (!_requestsTranslation[key]) {\n          var regex = /((http(s?)):\\/\\/)/g; // Check to see if the string from the endpoint variable contains https/http or not.\n\n          var urlEndpoint = endpoint || _ddsEndpoint;\n          var locationParam = country !== 'undefined' ? \"\".concat(country).concat(lang) : \"\".concat(lang);\n          var host = regex.test(endpoint) ? '' : _host;\n          var url = \"\".concat(host).concat(urlEndpoint, \"/\").concat(locationParam, \".json\");\n          _requestsTranslation[key] = axios.get(url, {\n            headers: {\n              'Content-Type': 'text/plain',\n              origin: _host\n            }\n          }).then(function (response) {\n            return _this2.transformData(response.data);\n          }).then(function (data) {\n            data['timestamp'] = Date.now();\n\n            if (typeof sessionStorage !== 'undefined') {\n              sessionStorage.setItem(\"\".concat(sessionKey, \"-\").concat(key), JSON.stringify(data));\n            }\n\n            return data;\n          });\n        }\n\n        _requestsTranslation[key].then(resolve, function (error) {\n          if (country === _localeDefault.cc && lang === _localeDefault.lc) {\n            reject(error);\n          } else {\n            _this2.fetchTranslation(_localeDefault.lc, _localeDefault.cc, endpoint, resolve, reject);\n          }\n        });\n      }\n    }\n    /**\n     * sets the Session key depending on API endpoint\n     *\n     * @param {string} endpoint specified endpoint passed as arg in getTranslation()\n     * @returns {string} session key\n     * @private\n     */\n\n  }, {\n    key: \"getSessionKey\",\n    value: function getSessionKey(endpoint) {\n      var sessionKey = _sessionTranslationKey; // form session key from specified endpoint\n\n      if (_ddsEndpointDefault !== _ddsEndpoint || endpoint) {\n        var endpointSrc = endpoint || _ddsEndpoint;\n        sessionKey = endpointSrc.replace(/[`~!@#$%^&*()_|+\\-=?;:'\",.<>{}[\\]\\\\/]/gi, '');\n      }\n\n      return sessionKey;\n    }\n    /**\n     * Transforms translation data\n     *\n     * @param   {object} data translation data to be transformed\n     * @returns {object} Translation data\n     * @private\n     */\n\n  }, {\n    key: \"transformData\",\n    value: function transformData(data) {\n      var _data$profileMenu;\n\n      var signedout = (_data$profileMenu = data.profileMenu) === null || _data$profileMenu === void 0 ? void 0 : _data$profileMenu.signedout;\n\n      if (signedout) {\n        var strReplace = 'state=https%3A%2F%2Fwww.ibm.com';\n        var loginIdx = signedout.findIndex(function (elem) {\n          var _elem$url;\n\n          return ((_elem$url = elem.url) === null || _elem$url === void 0 ? void 0 : _elem$url.indexOf(strReplace)) !== -1;\n        });\n\n        if (loginIdx !== -1 && root.location) {\n          var location = encodeURIComponent(root.location.href);\n          data.profileMenu.signedout[loginIdx].url = signedout[loginIdx].url.replace(strReplace, \"state=\".concat(location));\n        }\n      }\n\n      data.footerMenu.push(data.socialFollow);\n      return data;\n    }\n    /**\n     * Retrieves session cache and checks if cache needs to be refreshed\n     *\n     * @param   {string} key session storage key\n     * @returns {object} session storage object\n     * @private\n     */\n\n  }, {\n    key: \"getSessionCache\",\n    value: function getSessionCache(key) {\n      var session = typeof sessionStorage === 'undefined' ? undefined : JSON.parse(sessionStorage.getItem(key));\n\n      if (!session || !session.timestamp) {\n        return;\n      }\n\n      var currentTime = Date.now(),\n          timeDiff = currentTime - session.timestamp;\n\n      if (timeDiff > _twoHours) {\n        sessionStorage.removeItem(key);\n        return;\n      }\n\n      return session;\n    }\n  }]);\n\n  return TranslationAPI;\n}();\n\nexport default TranslationAPI;","map":{"version":3,"sources":["/Users/henriquefelixcastro/Downloads/Educathon 2022/educathon-2022-website/node_modules/@carbon/ibmdotcom-react/es/internal/vendor/@carbon/ibmdotcom-services/services/Translation/Translation.js"],"names":["_asyncToGenerator","_classCallCheck","_createClass","_regeneratorRuntime","axios","LocaleAPI","root","_host","process","env","REACT_APP_TRANSLATION_HOST","TRANSLATION_HOST","_ddsEndpointDefault","_ddsEndpoint","REACT_APP_DDS_TRANSLATION_ENDPOINT","DDS_TRANSLATION_ENDPOINT","_sessionTranslationKey","_requestsTranslation","_localeDefault","lc","cc","_twoHours","TranslationAPI","key","value","clearCache","endpoint","sessionKey","getSessionKey","sessionStorage","Object","keys","forEach","i","length","indexOf","removeItem","_getTranslation","mark","_callee","codes","_this","lang","country","locale","wrap","_callee$","_context","prev","next","getLocale","sent","abrupt","Promise","resolve","reject","fetchTranslation","stop","getTranslation","_x","_x2","apply","arguments","_this2","itemKey","concat","sessionTranslation","getSessionCache","regex","urlEndpoint","locationParam","host","test","url","get","headers","origin","then","response","transformData","data","Date","now","setItem","JSON","stringify","error","endpointSrc","replace","_data$profileMenu","signedout","profileMenu","strReplace","loginIdx","findIndex","elem","_elem$url","location","encodeURIComponent","href","footerMenu","push","socialFollow","session","undefined","parse","getItem","timestamp","currentTime","timeDiff"],"mappings":"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","sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\n/**\n * Copyright IBM Corp. 2020, 2021\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport axios from 'axios';\nimport { LocaleAPI } from '../Locale';\nimport root from 'window-or-global';\n/**\n * @constant {string | string} Host for the Translation API call\n * @private\n */\n\nvar _host = process && (process.env.REACT_APP_TRANSLATION_HOST || process.env.TRANSLATION_HOST) || 'https://1.www.s81c.com';\n/**\n * Translation API default endpoint\n *\n * @type {string}\n * @private\n */\n\n\nvar _ddsEndpointDefault = '/common/carbon-for-ibm-dotcom/translations/masthead-footer';\n/**\n * Translation API endpoint\n *\n * @type {string}\n * @private\n */\n\nvar _ddsEndpoint = process && (process.env.REACT_APP_DDS_TRANSLATION_ENDPOINT || process.env.DDS_TRANSLATION_ENDPOINT) || _ddsEndpointDefault;\n/**\n * Session Storage key for translation data\n *\n * @type {string}\n * @private\n */\n\n\nvar _sessionTranslationKey = 'dds-translation';\n/**\n * The cache for in-flight or resolved requests for the i18n data, keyed by the initiating locale.\n *\n * @type {object}\n * @private\n */\n\nvar _requestsTranslation = {};\n/**\n * Sets the default location if nothing is returned\n *\n * @type {object}\n * @private\n */\n\nvar _localeDefault = {\n  lc: 'en',\n  cc: 'us'\n};\n/**\n * Two hours in milliseconds to compare session timestamp.\n *\n * @type {number}\n * @private\n */\n\nvar _twoHours = 60 * 60 * 2000;\n/**\n * Translation API class with methods for fetching i18n data for ibm.com\n */\n\n\nvar TranslationAPI = /*#__PURE__*/function () {\n  function TranslationAPI() {\n    _classCallCheck(this, TranslationAPI);\n  }\n\n  _createClass(TranslationAPI, null, [{\n    key: \"clearCache\",\n\n    /**\n     * Clears the cache.\n     *\n     * @param {string} endpoint specified API non-default endpoint (optional)\n     */\n    value: function clearCache(endpoint) {\n      var sessionKey = this.getSessionKey(endpoint);\n\n      if (typeof sessionStorage !== 'undefined') {\n        Object.keys(_requestsTranslation).forEach(function (key) {\n          return delete _requestsTranslation[key];\n        });\n\n        for (var i = 0; i < sessionStorage.length; ++i) {\n          var key = sessionStorage.key(i);\n\n          if (key.indexOf(sessionKey) === 0) {\n            sessionStorage.removeItem(key);\n          }\n        }\n      }\n    }\n    /**\n     * Returns translation i18n data\n     *\n     * @param {object} codes object containing lc and cc\n     * @param {string} endpoint endpoint to fetch data from (optional)\n     *\n     * @returns {Promise<any>} Translation data\n     * @example\n     * import { TranslationAPI } from '@carbon/ibmdotcom-services';\n     *\n     * async function getTranslation() {\n     *   const response = await TranslationAPI.getTranslation({\n     *     lc: 'en',\n     *     cc: 'us',\n     *   });\n     *   return response;\n     * }\n     */\n\n  }, {\n    key: \"getTranslation\",\n    value: function () {\n      var _getTranslation = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(codes, endpoint) {\n        var _this = this;\n\n        var lang, country, locale;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                lang = 'en';\n                country = 'us';\n\n                if (!(codes && codes.lc && codes.cc)) {\n                  _context.next = 7;\n                  break;\n                }\n\n                lang = codes.lc;\n                country = codes.cc;\n                _context.next = 12;\n                break;\n\n              case 7:\n                _context.next = 9;\n                return LocaleAPI.getLocale();\n\n              case 9:\n                locale = _context.sent;\n                lang = locale.lc;\n                country = locale.cc;\n\n              case 12:\n                return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this.fetchTranslation(lang, country, endpoint, resolve, reject);\n                }));\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getTranslation(_x, _x2) {\n        return _getTranslation.apply(this, arguments);\n      }\n\n      return getTranslation;\n    }()\n    /**\n     * Fetches the translation data from sessionStorage or data fetch\n     *\n     * @param {string} lang Language code\n     * @param {string} country Country code\n     * @param {string} endpoint endpoint to fetch data (optional)\n     * @param {Function} resolve resolves the Promise\n     * @param {Function} reject rejects the promise\n     * @private\n     */\n\n  }, {\n    key: \"fetchTranslation\",\n    value: function fetchTranslation(lang, country, endpoint, resolve, reject) {\n      var _this2 = this;\n\n      var sessionKey = this.getSessionKey(endpoint);\n      var itemKey = \"\".concat(sessionKey, \"-\").concat(country, \"-\").concat(lang);\n      var sessionTranslation = this.getSessionCache(itemKey);\n\n      if (sessionTranslation) {\n        resolve(sessionTranslation);\n      } else {\n        var key = country !== 'undefined' ? \"\".concat(country, \"-\").concat(lang) : \"\".concat(lang);\n\n        if (!_requestsTranslation[key]) {\n          var regex = /((http(s?)):\\/\\/)/g; // Check to see if the string from the endpoint variable contains https/http or not.\n\n          var urlEndpoint = endpoint || _ddsEndpoint;\n          var locationParam = country !== 'undefined' ? \"\".concat(country).concat(lang) : \"\".concat(lang);\n          var host = regex.test(endpoint) ? '' : _host;\n          var url = \"\".concat(host).concat(urlEndpoint, \"/\").concat(locationParam, \".json\");\n          _requestsTranslation[key] = axios.get(url, {\n            headers: {\n              'Content-Type': 'text/plain',\n              origin: _host\n            }\n          }).then(function (response) {\n            return _this2.transformData(response.data);\n          }).then(function (data) {\n            data['timestamp'] = Date.now();\n\n            if (typeof sessionStorage !== 'undefined') {\n              sessionStorage.setItem(\"\".concat(sessionKey, \"-\").concat(key), JSON.stringify(data));\n            }\n\n            return data;\n          });\n        }\n\n        _requestsTranslation[key].then(resolve, function (error) {\n          if (country === _localeDefault.cc && lang === _localeDefault.lc) {\n            reject(error);\n          } else {\n            _this2.fetchTranslation(_localeDefault.lc, _localeDefault.cc, endpoint, resolve, reject);\n          }\n        });\n      }\n    }\n    /**\n     * sets the Session key depending on API endpoint\n     *\n     * @param {string} endpoint specified endpoint passed as arg in getTranslation()\n     * @returns {string} session key\n     * @private\n     */\n\n  }, {\n    key: \"getSessionKey\",\n    value: function getSessionKey(endpoint) {\n      var sessionKey = _sessionTranslationKey; // form session key from specified endpoint\n\n      if (_ddsEndpointDefault !== _ddsEndpoint || endpoint) {\n        var endpointSrc = endpoint || _ddsEndpoint;\n        sessionKey = endpointSrc.replace(/[`~!@#$%^&*()_|+\\-=?;:'\",.<>{}[\\]\\\\/]/gi, '');\n      }\n\n      return sessionKey;\n    }\n    /**\n     * Transforms translation data\n     *\n     * @param   {object} data translation data to be transformed\n     * @returns {object} Translation data\n     * @private\n     */\n\n  }, {\n    key: \"transformData\",\n    value: function transformData(data) {\n      var _data$profileMenu;\n\n      var signedout = (_data$profileMenu = data.profileMenu) === null || _data$profileMenu === void 0 ? void 0 : _data$profileMenu.signedout;\n\n      if (signedout) {\n        var strReplace = 'state=https%3A%2F%2Fwww.ibm.com';\n        var loginIdx = signedout.findIndex(function (elem) {\n          var _elem$url;\n\n          return ((_elem$url = elem.url) === null || _elem$url === void 0 ? void 0 : _elem$url.indexOf(strReplace)) !== -1;\n        });\n\n        if (loginIdx !== -1 && root.location) {\n          var location = encodeURIComponent(root.location.href);\n          data.profileMenu.signedout[loginIdx].url = signedout[loginIdx].url.replace(strReplace, \"state=\".concat(location));\n        }\n      }\n\n      data.footerMenu.push(data.socialFollow);\n      return data;\n    }\n    /**\n     * Retrieves session cache and checks if cache needs to be refreshed\n     *\n     * @param   {string} key session storage key\n     * @returns {object} session storage object\n     * @private\n     */\n\n  }, {\n    key: \"getSessionCache\",\n    value: function getSessionCache(key) {\n      var session = typeof sessionStorage === 'undefined' ? undefined : JSON.parse(sessionStorage.getItem(key));\n\n      if (!session || !session.timestamp) {\n        return;\n      }\n\n      var currentTime = Date.now(),\n          timeDiff = currentTime - session.timestamp;\n\n      if (timeDiff > _twoHours) {\n        sessionStorage.removeItem(key);\n        return;\n      }\n\n      return session;\n    }\n  }]);\n\n  return TranslationAPI;\n}();\n\nexport default TranslationAPI;"]},"metadata":{},"sourceType":"module"}